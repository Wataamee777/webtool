<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å›²ã¿æŒ‡å®š ç¿»è¨³ãƒ„ãƒ¼ãƒ«</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: system-ui, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding: 20px;
}

h2 {
  margin-top: 0;
}

textarea {
  width: 100%;
  height: 220px;
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #334155;
  border-radius: 8px;
  padding: 10px;
  box-sizing: border-box;
}

.controls {
  margin: 10px 0;
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  align-items: center;
}

label {
  cursor: pointer;
}

input[type="text"] {
  width: 64px;
  padding: 6px;
  border-radius: 6px;
  border: none;
}

button {
  padding: 8px 14px;
  border-radius: 8px;
  border: none;
  background: #38bdf8;
  color: #020617;
  font-weight: bold;
  cursor: pointer;
}

button:hover {
  opacity: 0.9;
}

/* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨€èªãƒœã‚¿ãƒ³ */
#langHelpBtn {
  position: fixed;
  right: 16px;
  bottom: 16px;
  width: 52px;
  height: 52px;
  border-radius: 50%;
  border: none;
  background: #38bdf8;
  color: #020617;
  font-size: 22px;
  cursor: pointer;
  z-index: 10000;
  box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}

/* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.overlay.show {
  display: flex;
}

.modal {
  background: #020617;
  padding: 18px 22px;
  border-radius: 12px;
  max-width: 340px;
  width: 90%;
}

.modal h3 {
  margin-top: 0;
}

.modal ul {
  padding-left: 16px;
  max-height: 260px;
  overflow-y: auto;
}

.modal li {
  margin-bottom: 6px;
}
</style>
</head>

<body>

<h2>å›²ã¿æŒ‡å®š ç¿»è¨³ãƒ„ãƒ¼ãƒ«</h2>

<p>åŸæ–‡</p>
<textarea id="input" placeholder='ä¾‹: console.log("Hello world");'></textarea>

<div class="controls">
  <label><input type="checkbox" value="double" checked> " "</label>
  <label><input type="checkbox" value="single"> ' '</label>
  <label><input type="checkbox" value="paren"> ( )</label>
  <label><input type="checkbox" value="brace"> { }</label>
  <label><input type="checkbox" value="bracket"> [ ]</label>
  <label><input type="checkbox" value="angle"> &lt; &gt;</label>
</div>

<div class="controls">
  <span>è¨€èª:</span>
  <input id="source" type="text" value="en" title="ä¾‹: en / auto / fr">
  â†’
  <input id="target" type="text" value="ja" title="ä¾‹: ja / en / ko">
</div>

<button onclick="run()">ç¿»è¨³</button>

<p>çµæœ</p>
<textarea id="output"></textarea>

<!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ -->
<button id="langHelpBtn" onclick="openLang()">ğŸŒ</button>

<!-- è¨€èªã‚³ãƒ¼ãƒ‰ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div id="langOverlay" class="overlay" onclick="closeLang(event)">
  <div class="modal">
    <h3>è¨€èªã‚³ãƒ¼ãƒ‰å¯¾å¿œè¡¨</h3>
    <ul>
      <li><b>auto</b> â€“ è‡ªå‹•åˆ¤å®š</li>
      <li><b>en</b> â€“ è‹±èª</li>
      <li><b>ja</b> â€“ æ—¥æœ¬èª</li>
      <li><b>ko</b> â€“ éŸ“å›½èª</li>
      <li><b>zh</b> â€“ ä¸­å›½èª</li>
      <li><b>fr</b> â€“ ãƒ•ãƒ©ãƒ³ã‚¹èª</li>
      <li><b>es</b> â€“ ã‚¹ãƒšã‚¤ãƒ³èª</li>
      <li><b>de</b> â€“ ãƒ‰ã‚¤ãƒ„èª</li>
      <li><b>ru</b> â€“ ãƒ­ã‚·ã‚¢èª</li>
      <li><b>pt</b> â€“ ãƒãƒ«ãƒˆã‚¬ãƒ«èª</li>
    </ul>
    <button onclick="closeLang()">é–‰ã˜ã‚‹</button>
  </div>
</div>

<script>
const patterns = {
  double: /"([^"]*)"/g,
  single: /'([^']*)'/g,
  paren: /\(([^()]*)\)/g,
  brace: /\{([^{}]*)\}/g,
  bracket: /\[([^\[\]]*)\]/g,
  angle: /<([^<>]*)>/g
};

async function run() {
  let text = document.getElementById("input").value;
  const source = document.getElementById("source").value.trim();
  const target = document.getElementById("target").value.trim();

  const checked = [...document.querySelectorAll("input[type=checkbox]:checked")]
    .map(c => c.value);

  for (const key of checked) {
    const regex = patterns[key];
    const matches = [...text.matchAll(regex)];

    for (const m of matches) {
      const original = m[1];
      if (!original.trim()) continue;

      const translated = await translate(original, source, target);
      text = text.replace(m[0], m[0].replace(original, translated));
    }
  }

  document.getElementById("output").value = text;
}

async function translate(q, source, target) {
  const res = await fetch("https://libretranslate.com/translate", {
    method: "POST",
